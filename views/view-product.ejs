<%- include ('./navbar.ejs') %>

  <title>
    <%=result[1][0].name%> | Fika
  </title>
  <meta name="description" content="<%=result[1][0].name%> | Fika">

  <main class="content-wrapper" style="background:#fff">

    <section class="container" style="padding:20px 0">
      <div class="row">

        <div class="col-md-6" style="display:flex;gap:14px">

          <div style="width:70px;display:flex;flex-direction:column;gap:10px">
            <img src="https://fikaonline.in/images/<%=result[1][0].image%>"
              style="width:100%;border:1px solid #ddd;border-radius:8px;cursor:pointer"
              onclick="replaceMainImage(this.src)">

            <% for (let i=0; i < result[8].length; i++) { %>
              <img src="https://fikaonline.in/images/<%=result[8][i].image%>"
                style="width:100%;border:1px solid #ddd;border-radius:8px;cursor:pointer"
                onclick="replaceMainImage(this.src)">
              <% } %>
          </div>

          <div style="
          flex:1;
          border:2px dashed #dcdcdc;
          border-radius:18px;
          padding:20px;
          display:flex;
          justify-content:center;
          align-items:center;
          background:#fafafa
        ">
            <img id="mainProductImage" src="https://fikaonline.in/images/<%=result[1][0].image%>"
              style="max-width:100%;max-height:400px;cursor:zoom-in" onclick="openZoomModal(this.src)">
          </div>

        </div>
        <div class="col-md-6" style="padding-left:30px">

          <h1 style="font-size:22px;font-weight:600;margin-bottom:6px">
            <%=result[1][0].name%>
          </h1>

          <div style="font-size:13px;color:#666;margin-bottom:12px">
            ⭐⭐⭐⭐☆ (<%=result[9].length%> reviews)
          </div>

          <div style="font-size:26px;font-weight:700;color:#1a73e8" id="priceDisplay">
            ₹<%=result[1][0].net_amount%>
              <del style="font-size:14px;color:#999">₹<%=result[1][0].price%></del>
          </div>

          <input type="hidden" id="unitPrice" value="<%=result[1][0].net_amount%>">

          <% if(result[1][0].discount){ %>
            <div style="margin:6px 0">
              <span style="background:#ff5252;color:#fff;padding:4px 8px;border-radius:6px;font-size:12px">
                <%=result[1][0].discount%>% OFF
              </span>
            </div>
            <% } %>

              <style>

              </style>
              <div style="margin:10px 0;font-size:13px;color:<%=result[1][0].quantity>0?'#2e7d32':'#c62828'%>">
                <%=result[1][0].quantity>0?'In Stock':'Out of Stock'%>
              </div>

              <div style="
  display:inline-flex;
  align-items:center;
  border:1px solid #ccc;
  border-radius:999px;
  overflow:hidden;
  margin:14px 0
">
                <button onclick="decreaseQty()" style="
    width:40px;
    height:40px;
    border:none;
    background:#f5f5f5;
    font-size:20px;
    cursor:pointer
  ">−</button>

                <span id="qtyValue" style="
    min-width:40px;
    text-align:center;
    font-size:15px;
    font-weight:600
  ">1</span>

                <button onclick="increaseQty()" style="
    width:40px;
    height:40px;
    border:none;
    background:#f5f5f5;
    font-size:20px;
    cursor:pointer
  ">+</button>
              </div>

              <div style="display:flex;gap:10px;margin-bottom:18px">
                <button onclick="addToCartWithQty('<%=result[1][0].id%>')"
                  style="flex:1;background:#1a73e8;color:#fff;border:none;padding:12px;border-radius:10px;font-weight:600">
                  Add to Cart
                </button>

                <button onclick="addToWishlist('<%=result[1][0].id%>')"
                  style="width:46px;border:1px solid #ccc;border-radius:10px;background:#fff">
                  ❤
                </button>
              </div>

              <div style="display:flex;gap:18px;font-size:13px;color:#555;margin-bottom:24px">
                <span>✔ 1 Year Warranty</span>
                <span>✔ 7 Days Replacement</span>
                <span>✔ Free Shipping</span>
              </div>

              <!-- ACCORDION -->
              <div>
                <details style="border-top:1px solid #eee;padding:10px 0">
                  <summary style="font-weight:600;cursor:pointer">Description</summary>
                  <div style="font-size:14px;color:#444;margin-top:6px">
                    <%- decodedDescription %>
                  </div>
                </details>

                <details style="border-top:1px solid #eee;padding:10px 0">
                  <summary style="font-weight:600;cursor:pointer">Warranty & Returns</summary>
                  <div style="font-size:14px;color:#444;margin-top:6px">
                    12 months official warranty. 7 days replacement.
                  </div>
                </details>
              </div>

        </div>
      </div>
    </section>
    <section class="container-fluid px-4 px-md-5" style="padding-bottom:40px;margin-top: 120px;">
      <h2 style="font-size:18px;font-weight:600;margin-bottom:16px">Related Products</h2>

      
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px">

        <% for(i=0;i<result[2].length;i++){ %>

          <div style="border:2px dashed #ddd;border-radius:18px;padding:14px;position:relative">

            <img src="https://fikaonline.in/images/<%=result[2][i].image%>"
              style="width:100%;height:160px;object-fit:contain">

            <div
              style="background:#ffc107;padding:6px;border-radius:8px;font-size:13px;font-weight:600;text-align:center;margin:10px 0">
              High Playback
            </div>

            <div style="font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">
              <a style="text-decoration: none;" class="text-dark" href="/product?id=<%=result[2][i].id%>">
                <%= (result[2][i].name || '' ).replace(/"/g, '' ) %>
              </a>
            </div>

            <div style="font-size:13px;margin:6px 0">⭐ 4.8</div>

            <div style="font-size:20px;font-weight:700">
              ₹<%=result[2][i].net_amount%>
            </div>

            <button onclick="addToCart('<%=result[2][i].id%>')" style="
            position:absolute;
            bottom:14px;
            right:14px;
            width:44px;
            height:44px;
            border-radius:50%;
            align-items: center;
            border:2px solid #1a73e8;
            background:#fff;
            color:#1a73e8;
            font-size:18px
          ">
              <i class="ci-shopping-cart"></i>
            </button>

          </div>

          <% } %>
      </div>
    </section>
    <div id="zoomModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  z-index:9999;
  align-items:center;
  justify-content:center
" onmouseleave="closeZoomModal()">

      <button onclick="closeZoomModal()" style="
    position:absolute;
    top:20px;
    right:20px;
    width:40px;
    height:40px;
    border:none;
    border-radius:50%;
    background:#fff;
    font-size:22px;
    cursor:pointer;
    line-height:1;
  ">✕</button>

      <img id="zoomImage" style="
    max-width:90%;
    max-height:90%;
    background:#fff;
    padding:20px;
    border-radius:16px
  ">
    </div>

    <script>
      function replaceMainImage(src) {
        document.getElementById("mainProductImage").src = src;
      }

      function openZoomModal(src) {
        const modal = document.getElementById("zoomModal");
        document.getElementById("zoomImage").src = src;
        modal.style.display = "flex";
      }

      function closeZoomModal() {
        document.getElementById("zoomModal").style.display = "none";
      }

      const zoomModal = document.getElementById("zoomModal");
      zoomModal.addEventListener("mouseleave", function () {
        closeZoomModal();
      });
    </script>

    <script>
      let qty = 1;
      const unitPrice = Number(document.getElementById("unitPrice").value);

      function updatePrice() {
        document.getElementById("priceDisplay").innerHTML =
          `₹${unitPrice * qty}`;
      }

      function increaseQty() {
        qty++;
        document.getElementById("qtyValue").innerText = qty;
        updatePrice();
      }

      function decreaseQty() {
        if (qty > 1) {
          qty--;
          document.getElementById("qtyValue").innerText = qty;
          updatePrice();
        }
      }

      function addToCartWithQty(productId) {
        if (typeof addToCart === "function") {
          addToCart(productId, qty);
        } else {
          console.log("Add to cart:", productId, qty);
        }
      }
    </script>


  </main>

  <%- include ('./footer.ejs') %>