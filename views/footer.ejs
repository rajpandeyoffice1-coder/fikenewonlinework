<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  ::-webkit-scrollbar {
    width: 8px
  }

  ::-webkit-scrollbar-track {
    background: transparent;
    margin: 4px 0
  }

  ::-webkit-scrollbar-thumb {
    background-color: #9e9e9e;
    border-radius: 20px;
    border: 2px solid transparent;
    background-clip: padding-box
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: #6f6f6f
  }

  * {
    scrollbar-width: thin;
    scrollbar-color: #9e9e9e transparent
  }
</style>

<script>
  const Toast = Swal.mixin({
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 2000,
    timerProgressBar: true
  });

  function showSuccess(msg) { Toast.fire({ icon: 'success', title: msg }) }
  function showError(msg) { Toast.fire({ icon: 'error', title: msg }) }
  function showInfo(msg) { Toast.fire({ icon: 'info', title: msg }) }

  function addToCart(booking_id) {
    let quantity = $('#quantity').val() ? $('#quantity').val() : 1;
    const size = 'free';

    $.post('/cart-handler1', { booking_id, quantity, size }, (data) => {
      if (data.msg === 'updated successfully' || Array.isArray(data)) {
        showSuccess('Added to cart');
        updateCartBadge(data);
      } else {
        showError('Something went wrong');
      }
    }).fail(() => { showError('Failed to connect to server') });
  }

  function addToCart1(booking_id, updated_one, quantity) {
    quantity = parseInt(quantity) + parseInt(updated_one);
    if (quantity < 0) quantity = 0;
    const size = 'free';

    $.post('/cart-handler1', { booking_id, quantity, size }, (data) => {
      if (data.msg === 'updated successfully' || Array.isArray(data)) {
        showSuccess('Cart updated');
        updateCartBadge(data);
        location.reload();
      }
      else {
        showError('Something went wrong');
      }
    }).fail(() => { showError('Failed to connect to server') });
  }

  async function addToWishlist(booking_id) {
    try {
      const response = await fetch('/add_wishlist', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ booking_id })
      });
      if (!response.ok) throw new Error();
      const result = await response.json();
      if (result.msg === 'The product already exists in your wishlist') {
        showInfo('Already in wishlist');
      } else if (result.msg === 'The product was successfully added to your wishlist') {
        showSuccess('Added to wishlist');
      } else {
        showError('Unexpected response');
      }
    } catch {
      showError('Unable to add to wishlist');
    }
  }

  function updateCartBadge(data) {
    if (!data || !data.cartCount) return;
    const badge = document.querySelector('.cart-count');
    if (badge) badge.textContent = data.cartCount;
  }
</script>